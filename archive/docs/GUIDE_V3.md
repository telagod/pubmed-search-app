# BMAL1文献检索系统 v3.0 - 高级版使用指南

**版本**: v3.0 (Advanced Edition)
**作者**: KOOI Research Assistant ฅ'ω'ฅ
**更新时间**: 2025-11-10

---

## 🆕 v3.0 新特性

### 核心升级

1. **🔧 Web界面配置**
   - 无需修改代码或.env文件
   - 直接在浏览器中配置PubMed邮箱和API密钥
   - 配置自动保存和加载
   - 支持配置导入/导出

2. **🔍 高级搜索功能**
   - 简单模式：快速输入查询字符串
   - 高级模式：可视化查询构建器
   - 支持复杂逻辑组合（AND/OR）
   - 支持字段筛选（作者、期刊、机构等）
   - 支持日期范围筛选

3. **📜 搜索历史管理**
   - 自动记录所有搜索
   - 显示搜索参数和结果统计
   - 一键重新执行历史搜索
   - 可清空搜索历史

4. **⚙️ 灵活的配置选项**
   - 可调整每次搜索最大结果数
   - 可调整批次大小
   - 可选择排序方式（相关性/日期）
   - 可选择导出格式（JSON/MD/CSV）

---

## 🚀 快速开始

### 1. 启动应用

```bash
cd /home/telagod/project/daily/1110/workflow
uv run streamlit run streamlit_app.py
```

### 2. 访问应用

应用启动后，在浏览器中访问：
- **本地**: http://localhost:8501
- **局域网**: http://192.168.1.226:8501
- **外网**: http://13.229.82.142:8501

### 3. 首次配置

第一次使用需要配置PubMed API：

1. 点击左侧导航栏的 **"⚙️ 设置"**
2. 填写必需信息：
   - **Email**: 您的PubMed注册邮箱
   - **API Key**: NCBI API密钥
3. 可选调整：
   - 每次搜索最大结果数（默认100）
   - 批次大小（默认20）
   - 排序方式（默认相关性）
4. 点击 **"💾 保存配置"**

**提示**: 如果您已经在`.env`文件中配置，系统会自动加载

---

## 📖 功能详解

### ⚙️ 设置页面

#### PubMed API配置

**必填项**:
- **Email**: PubMed注册邮箱地址
- **API Key**: NCBI API密钥（申请地址: https://www.ncbi.nlm.nih.gov/account/settings/）

**可选项**:
- **每次搜索最大结果数** (10-500): 控制单次搜索获取的文献数量
- **批次大小** (10-100): 控制每批获取的文献数量，影响下载速度
- **默认排序方式**:
  - `relevance`: 按相关性排序（推荐）
  - `pub_date`: 按发表日期排序

#### 配置管理

- **📥 导出配置**: 将当前配置和搜索历史导出为JSON文件
- **📤 导入配置**: 从JSON文件导入配置
- **🗑️ 清空搜索历史**: 删除所有搜索记录

---

### 🔍 高级搜索页面

#### Tab 1: 简单查询

适合已经熟悉PubMed查询语法的用户。

**使用步骤**:
1. 输入搜索名称（便于管理）
2. 输入PubMed查询字符串
   ```
   示例: BMAL1 AND (Alzheimer OR dementia)
   ```
3. 设置参数：
   - 最大结果数
   - 排序方式
   - 导出格式
4. 点击 **"🚀 开始搜索"**

**查询语法示例**:
```
# 基础查询
BMAL1

# AND逻辑
BMAL1 AND Alzheimer

# OR逻辑
BMAL1 AND (circadian OR clock)

# NOT逻辑
BMAL1 NOT review

# 字段限定
BMAL1[Title]
Smith[Author]
Nature[Journal]
2020:2024[Publication Date]
```

#### Tab 2: 高级查询

提供可视化的查询构建器，无需手动编写复杂语法。

**关键词部分**:
- 输入多个关键词，用逗号分隔
- 选择逻辑运算符：AND（同时包含）或 OR（包含任一）

**字段筛选**（可选）:
- **作者**: 作者姓名
- **期刊**: 期刊名称
- **发表类型**: 如 Review, Clinical Trial
- **机构**: 作者所属机构

**日期范围**（可选）:
- 勾选"启用日期筛选"
- 选择开始日期和结束日期

**示例**:

假设要查找：
- 关键词：BMAL1, circadian, sleep
- 逻辑：AND
- 作者：Smith
- 期刊：Nature
- 日期：2020-2024

系统会自动构建查询：
```
BMAL1 AND circadian AND sleep AND Smith[Author] AND Nature[Journal]
```
并应用日期筛选。

#### Tab 3: 搜索历史

显示最近20条搜索记录。

**功能**:
- 查看搜索参数
- 查看结果统计
- **🔄 重新执行**: 一键重新运行历史搜索

---

### 📊 Dashboard

显示数据库整体统计信息。

**统计卡片**:
- 📚 总文献数
- ✅ 有摘要文献数
- 📰 独特期刊数
- 🔍 检索策略数

**可视化图表**:
- 按检索策略分布（饼图）
- 发表年份趋势（柱状图）
- Top 15高频关键词（横向条形图）
- Top 15高频MeSH主题词（横向条形图）

---

### 📚 文献浏览器

强大的文献筛选和浏览功能。

**筛选器**（左侧边栏）:
- **检索策略**: 按策略筛选
- **关键词搜索**: 在标题、摘要、关键词中搜索
- **年份范围**: 滑块选择发表年份
- **每页显示**: 10/20/50/100条

**浏览功能**:
- **排序**: 按年份、标题、期刊排序
- **分页**: 自动分页，可跳转
- **文献卡片**: 显示标题、期刊、日期、PMID、DOI
- **展开详情**: 查看作者、摘要、关键词、MeSH主题词

**使用场景**:

1. **查找特定主题文献**:
   - 设置检索策略 = "ALZHEIMER"
   - 关键词搜索 = "sleep"
   - 年份 = 2020-2024
   - 结果：所有关于BMAL1、阿尔茨海默病和睡眠的2020-2024年文献

2. **浏览最新文献**:
   - 排序 = "发表年份(新→旧)"
   - 每页显示 = 50
   - 逐页浏览

---

### 📈 数据分析

多维度数据可视化分析。

#### Tab 1: 📊 年份分析
- **堆叠柱状图**: 各检索策略在不同年份的文献分布
- **累计增长曲线**: 文献数量随时间的累积趋势

**用途**: 识别研究热度变化和发展趋势

#### Tab 2: 📰 期刊分析
- **Top 20期刊**: 横向条形图

**用途**: 了解文献主要发表在哪些期刊，确定领域重要期刊

#### Tab 3: 🏷️ 词频分析
- **关键词树状图**: Top 30关键词
- **MeSH主题词树状图**: Top 30 MeSH主题词

**用途**: 识别研究主题和热点词汇

---

## 💡 使用技巧

### 1. 高效搜索策略

**场景A**: 探索性搜索
```
策略: 使用"简单查询"
查询: BMAL1 AND Alzheimer
最大结果数: 100
排序: 相关性
```

**场景B**: 针对性搜索
```
策略: 使用"高级查询"
关键词: BMAL1, circadian, tau
逻辑: AND
作者: Salminen
日期: 2020-2024
```

**场景C**: 综述性搜索
```
策略: 使用"简单查询"
查询: BMAL1 AND Review[Publication Type]
最大结果数: 50
排序: 发表日期
```

### 2. 利用搜索历史

1. 在"高级搜索 → 搜索历史"查看之前的搜索
2. 找到相关的历史搜索
3. 点击"🔄 重新执行"
4. 系统会使用相同参数重新搜索（获取最新文献）

### 3. 配置优化

**大量文献**:
- 最大结果数: 500
- 批次大小: 50
- 注意：会增加下载时间

**快速预览**:
- 最大结果数: 20
- 批次大小: 20
- 排序: 相关性

**时间序列研究**:
- 排序方式: pub_date
- 结合年份筛选使用

### 4. 数据导出和备份

1. **导出搜索结果**:
   - 每次搜索自动导出为JSON/MD/CSV
   - 文件保存在 `results/` 目录

2. **备份配置**:
   - 定期使用"导出配置"功能
   - 保存配置JSON文件

3. **迁移到新环境**:
   - 导出配置JSON
   - 复制数据库文件 `bmal1_papers.db`
   - 在新环境导入配置

---

## 🔧 高级功能

### 自定义查询语法

PubMed支持丰富的查询语法：

#### 字段标签
```
[Title]          - 标题
[Abstract]       - 摘要
[Author]         - 作者
[Journal]        - 期刊
[Affiliation]    - 机构
[MeSH Terms]     - MeSH主题词
[Publication Date] - 发表日期
[Publication Type] - 发表类型
[All Fields]     - 所有字段（默认）
```

#### 逻辑运算符
```
AND  - 同时包含
OR   - 包含任一
NOT  - 排除
```

#### 通配符
```
*    - 任意字符
?    - 单个字符

示例: carcin* 匹配 carcinoma, carcinogen等
```

#### 短语搜索
```
"exact phrase"  - 精确短语

示例: "circadian rhythm"
```

#### 日期范围
```
2020:2024[Publication Date]
2020/01/01:2020/12/31[Publication Date]
```

#### 组合示例
```
# 复杂查询
(BMAL1 OR ARNTL) AND (Alzheimer OR "Alzheimer's disease") AND 2020:2024[Publication Date] NOT review[Publication Type]

# 意义：
# - 包含 BMAL1 或 ARNTL
# - 且包含 Alzheimer 或精确短语 "Alzheimer's disease"
# - 且发表于2020-2024年
# - 且不是综述类型
```

### 批量操作

**批量筛选文献**:
1. 在"文献浏览器"使用筛选器
2. 导出当前视图（CSV格式）
3. 使用Excel或Python进一步处理

**批量分析关键词**:
1. 进入"数据分析 → 词频分析"
2. 查看树状图
3. 导出数据用于词云生成或其他分析

---

## 🐛 常见问题

### Q1: 配置保存后重启应用丢失？

**原因**: 配置文件路径问题

**解决**:
1. 检查 `config/settings.json` 是否存在
2. 重新在设置页面保存配置
3. 或手动创建配置文件

### Q2: 搜索时提示"配置验证失败"？

**原因**: Email或API Key无效

**解决**:
1. 检查Email格式（需包含@）
2. 检查API Key是否正确
3. 重新获取API Key: https://www.ncbi.nlm.nih.gov/account/settings/

### Q3: 搜索卡住或很慢？

**原因**: 网络问题或请求数量过多

**解决**:
1. 检查网络连接
2. 减小"最大结果数"
3. 增加"批次大小"以减少请求次数
4. 检查API速率限制

### Q4: 数据库显示为空？

**原因**: 数据库文件不存在或路径错误

**解决**:
1. 检查 `results/bmal1_papers.db` 是否存在
2. 先执行一次搜索生成数据库
3. 或运行 `uv run python pubmed_search_v2.py`

### Q5: 导出的CSV文件中文乱码？

**原因**: Excel默认编码问题

**解决**:
1. CSV文件已使用UTF-8-sig编码
2. 用Excel打开时选择"数据 → 从文本/CSV"
3. 指定编码为UTF-8

### Q6: 搜索历史太多怎么办？

**解决**:
1. 进入"设置"页面
2. 点击"🗑️ 清空搜索历史"
3. 或手动编辑 `config/search_history.json`

---

## 📊 系统架构

### 文件结构
```
workflow/
├── config_manager.py          # 配置管理模块
├── advanced_search.py         # 高级搜索引擎
├── pubmed_search_v2.py        # 基础搜索和解析
├── streamlit_app.py           # v3.0 WebUI主程序
├── streamlit_app_v1.py        # v1备份
├── config/                    # 配置目录
│   ├── settings.json          # 用户配置
│   └── search_history.json    # 搜索历史
├── results/                   # 结果目录
│   ├── bmal1_papers.db        # SQLite数据库
│   ├── *.json/md/csv          # 搜索结果文件
│   └── pubmed_search_*.log    # 日志文件
└── ...
```

### 技术组件

**后端**:
- `config_manager.py`: 配置和历史管理
- `advanced_search.py`: 高级搜索引擎
- `pubmed_search_v2.py`: 文献解析和数据库操作

**前端**:
- `streamlit_app.py`: Web界面主程序
- Streamlit: Web框架
- Plotly: 交互式图表

**数据层**:
- SQLite: 关系数据库
- JSON: 配置和历史存储
- CSV/MD: 数据导出

---

## 🔄 版本对比

| 功能 | v1.0 | v2.0 | v3.0 |
|------|------|------|------|
| 基础检索 | ✅ | ✅ | ✅ |
| 数据库存储 | ❌ | ✅ | ✅ |
| Web可视化 | ✅ | ✅ | ✅ |
| 配置管理 | 文件 | 文件 | Web界面 |
| 高级搜索 | ❌ | ❌ | ✅ |
| 搜索历史 | ❌ | ❌ | ✅ |
| 查询构建器 | ❌ | ❌ | ✅ |
| 配置导入导出 | ❌ | ❌ | ✅ |
| 成功率 | 71% | 100% | 100% |

---

## 🎯 最佳实践

### 1. 研究工作流

**阶段1: 探索性搜索**
```
1. 使用简单查询，广泛的关键词
2. 查看Dashboard统计
3. 分析高频词汇
```

**阶段2: 针对性检索**
```
1. 根据阶段1的发现，使用高级查询
2. 添加作者、期刊、日期筛选
3. 获取高质量文献
```

**阶段3: 深度分析**
```
1. 在文献浏览器精细筛选
2. 导出重点文献
3. 使用数据分析识别趋势
```

### 2. 配置建议

**日常使用**:
- 最大结果数: 100
- 批次大小: 20
- 排序: relevance

**大规模调研**:
- 最大结果数: 500
- 批次大小: 50
- 定期备份数据库

**快速查询**:
- 最大结果数: 20
- 批次大小: 20
- 使用搜索历史

### 3. 数据管理

1. **定期备份**:
   - 导出配置（每月）
   - 备份数据库文件（每周）
   - 保存重要的搜索结果文件

2. **清理策略**:
   - 定期清理旧的搜索历史
   - 删除不需要的导出文件
   - 保持数据库精简

3. **版本控制**:
   - 为重要的搜索结果添加版本标记
   - 记录搜索日期和参数
   - 使用搜索名称进行分类

---

## 📞 技术支持

### 获取帮助

1. **文档查阅**:
   - 本使用指南
   - `README.md`
   - `STREAMLIT_GUIDE.md` (v1/v2文档)

2. **日志检查**:
   - 查看 `results/pubmed_search_*.log`
   - 检查控制台错误信息

3. **问题报告**:
   - 提供详细的错误信息
   - 包含配置和搜索参数
   - 附上日志文件相关部分

### 常用资源

- **PubMed帮助**: https://pubmed.ncbi.nlm.nih.gov/help/
- **API文档**: https://www.ncbi.nlm.nih.gov/books/NBK25501/
- **查询语法**: https://pubmed.ncbi.nlm.nih.gov/advanced/

---

## 🎓 教程示例

### 示例1: 寻找最新综述

**目标**: 找到2023-2024年关于BMAL1与阿尔茨海默病的综述文章

**步骤**:
1. 进入"高级搜索 → 简单查询"
2. 输入查询:
   ```
   BMAL1 AND Alzheimer AND Review[Publication Type] AND 2023:2024[Publication Date]
   ```
3. 设置:
   - 最大结果数: 50
   - 排序: 发表日期
   - 导出格式: JSON, MD, CSV
4. 点击"开始搜索"
5. 在"文献浏览器"查看结果

### 示例2: 构建复杂查询

**目标**: 找到特定作者在特定期刊发表的关于BMAL1和睡眠的文章

**步骤**:
1. 进入"高级搜索 → 高级查询"
2. 填写:
   - 关键词: `BMAL1, sleep, circadian`
   - 逻辑运算符: AND
   - 作者: `Salminen`
   - 期刊: `Nature`或留空
   - 日期筛选: 2020-2024
3. 查看构建的查询
4. 点击"开始搜索"

### 示例3: 重复历史搜索

**目标**: 重新执行上个月的搜索，获取最新文献

**步骤**:
1. 进入"高级搜索 → 搜索历史"
2. 找到相关的历史记录
3. 点击"🔄 重新执行"
4. 系统会使用相同参数执行新的搜索
5. 对比新旧结果，查看新增文献

---

**最后更新**: 2025-11-10
**文档版本**: 3.0
**应用版本**: 3.0 Advanced

*享受高级文献检索的便利喵～* ฅ'ω'ฅ
