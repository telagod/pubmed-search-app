# BMAL1文献检索系统 - Streamlit可视化指南

**创建时间**: 2025-11-10
**作者**: KOOI Research Assistant ฅ'ω'ฅ
**版本**: v2.0

---

## 📋 快速开始

### 1. 安装依赖

```bash
# 切换到workflow目录
cd /home/telagod/project/daily/1110/workflow

# 使用uv安装依赖（如果还没安装）
uv pip install streamlit pandas plotly wordcloud matplotlib
```

### 2. 启动应用

```bash
# 使用uv运行Streamlit应用
uv run streamlit run streamlit_app.py

# 或指定端口
uv run streamlit run streamlit_app.py --server.port=8501
```

### 3. 访问应用

启动后，应用会提供三个访问地址：
- **本地访问**: http://localhost:8501
- **局域网访问**: http://192.168.1.226:8501 (根据实际网络)
- **外网访问**: http://47.128.148.7:8501 (如果配置了端口转发)

---

## 🎯 功能导航

### 📊 Dashboard（首页）

**主要功能**:
- **统计卡片**: 显示总文献数、有摘要数、独特期刊数、检索策略数
- **检索策略分布**: 饼图展示不同策略的文献占比
- **发表年份趋势**: 柱状图展示文献年份分布
- **高频关键词**: Top 15关键词横向条形图
- **高频MeSH主题词**: Top 15 MeSH主题词横向条形图

**使用场景**: 快速了解数据库整体情况

---

### 📚 文献浏览器

**主要功能**:

#### 筛选器（左侧边栏）
- **检索策略**: 选择特定策略或全部
- **关键词搜索**: 在标题、摘要、关键词中搜索
- **年份范围**: 滑块选择发表年份范围
- **每页显示**: 10/20/50/100条可选

#### 浏览功能
- **排序**: 支持按年份、标题、期刊排序
- **分页**: 自动分页，可跳转到指定页
- **文献卡片**: 清晰展示标题、期刊、日期、PMID、DOI
- **展开详情**: 点击查看作者、摘要、关键词、MeSH主题词

**使用场景**: 浏览和筛选特定文献

**示例操作**:
1. 选择"ALZHEIMER"策略
2. 输入关键词"circadian"
3. 设置年份范围2020-2024
4. 按年份从新到旧排序
5. 点击展开查看感兴趣的文献详情

---

### 📈 数据分析

#### Tab 1: 📊 年份分析
- **堆叠柱状图**: 各策略在不同年份的文献分布
- **累计增长曲线**: 文献数量随时间的累积趋势

**用途**: 识别研究热度变化和趋势

#### Tab 2: 📰 期刊分析
- **Top 20期刊**: 横向条形图展示发表最多的期刊
- **期刊分布**: 了解文献主要发表在哪些期刊

**用途**: 确定领域内重要期刊

#### Tab 3: 🏷️ 词频分析
- **关键词树状图**: Top 30关键词及其频次的树状可视化
- **MeSH主题词树状图**: Top 30 MeSH主题词的树状可视化

**用途**: 识别研究主题和热点

#### Tab 4: 📋 数据导出
- **导出CSV**: 下载所有文献数据为CSV格式
- **导出Excel**: 下载为Excel格式（需安装openpyxl）
- **数据预览**: 查看前50条数据

**用途**: 导出数据用于进一步分析或备份

---

### ℹ️ 关于

显示系统信息、检索策略、技术栈、当前数据统计等

---

## 💡 使用技巧

### 1. 高效筛选文献

**场景**: 我想找2022年后关于BMAL1与阿尔茨海默病的文献

**操作步骤**:
1. 进入"📚 文献浏览器"
2. 左侧边栏选择策略: "ALZHEIMER"
3. 年份滑块调整为: 2022 - 2024
4. 排序选择: "发表年份(新→旧)"
5. 浏览结果，展开感兴趣的文献

### 2. 识别研究热点

**场景**: 我想知道BMAL1研究中最常见的关键词

**操作步骤**:
1. 进入"📊 Dashboard"
2. 查看"高频关键词"图表
3. 或进入"📈 数据分析" → "词频分析"
4. 查看树状图获得更详细的词频分布

### 3. 分析时间趋势

**场景**: 我想了解BMAL1研究在不同年份的发展

**操作步骤**:
1. 进入"📈 数据分析" → "年份分析"
2. 查看堆叠柱状图，了解各策略文献分布
3. 查看累计增长曲线，了解整体研究趋势

### 4. 导出特定数据

**场景**: 我想导出2020-2024年的所有阿尔茨海默病相关文献

**方法一（使用筛选后导出）**:
1. 进入"📚 文献浏览器"
2. 筛选: 策略=ALZHEIMER，年份=2020-2024
3. 记录筛选后的PMID
4. 进入"📈 数据分析" → "数据导出"
5. 下载CSV后用Excel或Python进一步筛选

**方法二（直接导出全量数据后筛选）**:
1. 进入"📈 数据分析" → "数据导出"
2. 导出CSV
3. 使用Excel或Python按需筛选

---

## 🔧 技术细节

### 数据库结构

**papers表**:
- `pmid`: PubMed ID（主键）
- `title`: 文献标题
- `abstract`: 摘要
- `journal`: 期刊名称
- `pub_year`: 发表年份
- `pub_date`: 完整发表日期
- `authors`: 作者列表（JSON）
- `keywords`: 关键词列表（JSON）
- `mesh_terms`: MeSH主题词列表（JSON）
- `doi`: DOI标识符
- `search_strategy`: 检索策略标签
- `fetch_date`: 获取日期
- `pubmed_url`: PubMed链接
- `has_abstract`: 是否有摘要（0/1）

**索引**:
- `idx_pub_year`: 发表年份索引（加速年份查询）
- `idx_strategy`: 检索策略索引（加速策略筛选）
- `idx_journal`: 期刊索引（加速期刊统计）

### 关键代码模块

#### PaperDB类
```python
class PaperDB:
    """数据库访问类"""
    - get_all_papers(): 获取所有文献为DataFrame
    - get_statistics(): 获取统计信息
    - search_papers(): 搜索文献
    - get_top_keywords(): 获取高频关键词
    - get_top_mesh_terms(): 获取高频MeSH主题词
```

#### 页面函数
- `page_dashboard()`: Dashboard页面
- `page_browser()`: 文献浏览器页面
- `page_analysis()`: 数据分析页面
- `page_about()`: 关于页面

### 性能优化

1. **数据库缓存**: 使用`@st.cache_resource`缓存数据库连接
2. **索引优化**: 在常用查询字段上建立索引
3. **分页加载**: 文献浏览器支持分页，避免一次性加载所有数据
4. **DataFrame操作**: 使用Pandas高效处理和筛选数据

---

## 🐛 常见问题

### Q1: 应用启动失败，提示"command not found: streamlit"

**原因**: 未使用uv运行，或虚拟环境未激活

**解决方案**:
```bash
# 使用uv运行
uv run streamlit run streamlit_app.py

# 或激活虚拟环境后运行
source .venv/bin/activate
streamlit run streamlit_app.py
```

### Q2: 应用显示"数据库文件不存在"

**原因**: 数据库路径配置错误或未运行检索脚本

**解决方案**:
```bash
# 先运行检索脚本生成数据库
uv run python pubmed_search_v2.py

# 确保数据库文件存在
ls results/bmal1_papers.db
```

### Q3: 图表显示异常或数据为空

**原因**: 数据格式问题或数据库中无数据

**解决方案**:
1. 检查数据库是否有数据: `sqlite3 results/bmal1_papers.db "SELECT COUNT(*) FROM papers;"`
2. 重新运行检索脚本
3. 检查JSON字段是否正确解析

### Q4: 导出Excel时提示需要安装openpyxl

**解决方案**:
```bash
uv pip install openpyxl
```

### Q5: 端口8501被占用

**解决方案**:
```bash
# 使用其他端口
uv run streamlit run streamlit_app.py --server.port=8502

# 或杀死占用进程
lsof -ti:8501 | xargs kill -9
```

---

## 📊 数据统计（当前）

基于最新检索结果：

| 指标 | 数值 |
|------|------|
| **总文献数** | 154篇 |
| **有摘要文献** | 154篇 (100%) |
| **检索策略** | 4个 |
| **年份范围** | 多年份分布 |

**各策略文献数**:
- CIRCADIAN: 50篇
- ALZHEIMER: 50篇
- GLYMPHATIC: 17篇
- BBB: 50篇

---

## 🚀 未来功能规划

### 短期（已规划）
- [ ] 添加全文下载链接（如果有权限）
- [ ] 增加文献相似度分析
- [ ] 支持自定义检索策略
- [ ] 添加引用网络可视化

### 中期（考虑中）
- [ ] 集成自然语言处理进行摘要分析
- [ ] 添加文献推荐功能
- [ ] 支持批注和标记功能
- [ ] 添加协作分享功能

### 长期（探索中）
- [ ] 与文献管理软件（Zotero/Mendeley）集成
- [ ] AI辅助文献综述生成
- [ ] 多数据库联合检索（Web of Science, Scopus等）

---

## 📞 技术支持

如遇到问题或有功能建议：
1. 检查本文档的"常见问题"部分
2. 查看日志文件: `results/pubmed_search_*.log`
3. 检查数据库完整性
4. 联系开发者: KOOI Research Assistant

---

## 📄 许可与致谢

- **数据来源**: PubMed/NCBI
- **开发工具**: Python, Streamlit, Plotly, Biopython
- **包管理**: uv
- **数据库**: SQLite

**致谢**: 感谢PubMed提供的免费API服务

---

**最后更新**: 2025-11-10
**文档版本**: 1.0
**应用版本**: 2.0

*愉快地探索BMAL1文献吧！ ฅ'ω'ฅ*
